### **Các bước tạo một service với `systemd`**
_Generated by ChatGPT_
1. **Tạo file service:**
   File dịch vụ thường được lưu trong:
   - **System-wide:** `/etc/systemd/system/`
   - **User-level:** `~/.config/systemd/user/`

   Ví dụ:
   ```bash
   sudo nano /etc/systemd/system/my-service.service
   ```

2. **Cấu hình file service:**
   File dịch vụ cần ít nhất 3 phần: `[Unit]`, `[Service]`, và `[Install]`.

3. **Reload cấu hình `systemd`:**
   Sau khi tạo hoặc chỉnh sửa file:
   ```bash
   sudo systemctl daemon-reload
   ```

4. **Enable service để chạy khi khởi động:**
   ```bash
   sudo systemctl enable my-service
   ```

5. **Start service:**
   ```bash
   sudo systemctl start my-service
   ```

6. **Kiểm tra trạng thái:**
   ```bash
   sudo systemctl status my-service
   ```

---

### **Mô tả chi tiết các section và value trong file service**

#### **1. `[Unit]`: Mô tả và xác định phụ thuộc**
Phần này cung cấp thông tin tổng quan và yêu cầu phụ thuộc của dịch vụ.

| **Tham số**           | **Ý nghĩa**                                                                                              | **Ví dụ**                                 |
|-----------------------|----------------------------------------------------------------------------------------------------------|-------------------------------------------|
| `Description`         | Mô tả ngắn gọn về dịch vụ.                                                                               | `Description=My custom service`           |
| `After`               | Đảm bảo dịch vụ này chỉ chạy sau các dịch vụ hoặc target được liệt kê.                                   | `After=network.target`                    |
| `Requires`            | Xác định các dịch vụ bắt buộc. Nếu dịch vụ đó dừng, dịch vụ này cũng sẽ dừng.                           | `Requires=network.service`                |
| `Wants`               | Liệt kê các dịch vụ liên quan, nhưng không bắt buộc (không dừng nếu các dịch vụ này dừng).               | `Wants=network-online.target`             |
| `Condition...`        | Các điều kiện cần thiết để dịch vụ chạy (thời điểm, trạng thái hệ thống, v.v.).                          | `ConditionPathExists=/etc/my-config.conf` |

---

#### **2. `[Service]`: Cách dịch vụ hoạt động**
Phần này định nghĩa cách khởi động, dừng và restart dịch vụ.

| **Tham số**           | **Ý nghĩa**                                                                                              | **Ví dụ**                                  |
|-----------------------|----------------------------------------------------------------------------------------------------------|--------------------------------------------|
| `ExecStart`           | Lệnh để khởi động dịch vụ.                                                                               | `ExecStart=/usr/bin/python3 /path/app.py`  |
| `ExecStop`            | Lệnh để dừng dịch vụ (nếu không chỉ định, `SIGTERM` được gửi).                                          | `ExecStop=/bin/kill -s TERM $MAINPID`      |
| `ExecReload`          | Lệnh để reload (nếu được hỗ trợ).                                                                       | `ExecReload=/bin/kill -s HUP $MAINPID`     |
| `Restart`             | Điều kiện restart dịch vụ khi nó dừng (`always`, `on-failure`, `no`).                                   | `Restart=always`                          |
| `RestartSec`          | Thời gian chờ trước khi restart (giây).                                                                 | `RestartSec=5`                            |
| `User`                | Tài khoản người dùng mà dịch vụ sẽ chạy.                                                                | `User=www-data`                           |
| `Group`               | Nhóm người dùng mà dịch vụ sẽ chạy.                                                                     | `Group=www-data`                          |
| `WorkingDirectory`    | Thư mục làm việc của dịch vụ.                                                                           | `WorkingDirectory=/path/to/app`           |
| `StandardOutput`      | Xác định đầu ra của dịch vụ (console, journal, file).                                                   | `StandardOutput=journal`                  |
| `StandardError`       | Xác định đầu ra lỗi của dịch vụ.                                                                        | `StandardError=journal`                   |
| `Environment`         | Thiết lập biến môi trường cho dịch vụ.                                                                  | `Environment="ENV_VAR=value"`             |
| `EnvironmentFile`     | Chỉ định file chứa các biến môi trường.                                                                 | `EnvironmentFile=/path/to/env-file`       |

---

#### **3. `[Install]`: Cách kích hoạt dịch vụ**
Phần này xác định khi nào dịch vụ sẽ được kích hoạt.

| **Tham số**           | **Ý nghĩa**                                                                                              | **Ví dụ**                                  |
|-----------------------|----------------------------------------------------------------------------------------------------------|--------------------------------------------|
| `WantedBy`            | Xác định các target dịch vụ này thuộc về. Dùng để enable dịch vụ khởi động cùng hệ thống.                | `WantedBy=multi-user.target`               |
| `Alias`               | Tên thay thế để gọi dịch vụ.                                                                             | `Alias=my-alias.service`                   |

---

### **Ví dụ đầy đủ:**
File dịch vụ để chạy một ứng dụng Python:
```ini
[Unit]
Description=My Python Application
After=network.target

[Service]
ExecStart=/usr/bin/python3 /home/user/app.py
Restart=always
RestartSec=5
User=myuser
Group=mygroup
WorkingDirectory=/home/user
Environment="ENV=production" "DEBUG=false"
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

---

### **Các lệnh hữu ích**

| **Lệnh**                           | **Ý nghĩa**                                                |
|------------------------------------|------------------------------------------------------------|
| `sudo systemctl enable <service>` | Tự động khởi động dịch vụ khi boot.                       |
| `sudo systemctl disable <service>`| Ngừng tự động khởi động dịch vụ khi boot.                 |
| `sudo systemctl start <service>`  | Bắt đầu dịch vụ.                                           |
| `sudo systemctl stop <service>`   | Dừng dịch vụ.                                              |
| `sudo systemctl status <service>` | Kiểm tra trạng thái dịch vụ.                              |
| `sudo journalctl -u <service>`    | Xem log của dịch vụ.                                       |
| `sudo systemctl daemon-reload`    | Reload cấu hình dịch vụ sau khi chỉnh sửa file `.service`. |
